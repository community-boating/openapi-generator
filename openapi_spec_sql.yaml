openapi: 3.0.0
info:
  version: '1'
  title: ''
  description: ''
paths: {}
components:
  securitySchemes: {}
  schemas:
    Catalog:
      x-has-dao: true
      required: [assignId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/CatalogInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            items:
              x-parent-variable: catalogId
              #x-column-parent-fk: line
              type: array
              items:
                $ref: '#/components/schemas/Item'
            taxes:
              x-parent-variable: catalogId
              type: array
              items:
                $ref: '#/components/schemas/Tax'
            categories:
              x-parent-variable: catalogId
              type: array
              items:
                $ref: '#/components/schemas/Category'
            discounts:
              x-parent-variable: catalogId
              type: array
              items:
                $ref: '#/components/schemas/Discount'
            products:
              x-parent-variable: catalogId
              type: array
              items:
                $ref: '#/components/schemas/Product'
    Product:
      x-has-dao: true
      required: [assignId, productName, productDescription, active, catalogId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/ProductFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            catalogId:
              $ref: '#/components/schemas/Catalog'

    Item:
      x-has-dao: true
      required: [assignId, type]
      allOf:
        - $ref: './shared.yaml#/components/schemas/ItemInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            classTypeId:
              $ref: '#/components/schemas/ApClassType'
            classInstanceId:
              $ref: '#/components/schemas/ApClassInstance'
            membershipTypeId:
              $ref: '#/components/schemas/MembershipType'
            productId:
              $ref: '#/components/schemas/Product'
            catalogId:
              $ref: '#/components/schemas/Catalog'
            itemInstances:
              x-parent-variable: itemId
              type: array
              items:
                $ref: '#/components/schemas/ItemInstance'
            itemCategories:
              x-parent-variable: item
              type: array
              items:
                $ref: '#/components/schemas/ItemCategory'
            itemDiscounts:
              x-parent-variable: itemId
              type: array
              items:
                $ref: '#/components/schemas/ItemDiscount'
            itemTaxes:
              x-parent-variable: itemId
              type: array
              items:
                $ref: '#/components/schemas/ItemTax'
    DiscountCategory:
      x-has-dao: true
      required: [assignId, discountId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/DiscountCategoryFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            discountId:
              $ref: '#/components/schemas/Discount'
            categoryId:
              $ref: '#/components/schemas/Category'


    ItemCategory:
      x-has-dao: true
      required: [assignId, item, categoryId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/ItemCategoryFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            assignId:
              x-col-primary: true
              type: integer
              format: int64
            item:
              $ref: '#/components/schemas/Item'
            categoryId:
              $ref: '#/components/schemas/Category'

    Category:
      x-has-dao: true
      required: [assignId, categoryName, description, catalogId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/CategoryFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            catalogId:
              $ref: '#/components/schemas/Catalog'

    ItemInstance:
      x-has-dao: true
      required: [assignId, itemId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/ItemInstanceFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            itemId:
              $ref: '#/components/schemas/Item'

    ItemInstanceStockChange:
      x-has-dao: true
      required: [itemInstanceId, changeAmount, stockChangeType]
      allOf:
        - $ref: './shared.yaml#/components/schemas/ItemInstanceStockChangeFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            itemInstanceId:
              $ref: '#/components/schemas/ItemInstance'
            lineItemId:
              $ref: '#/components/schemas/LineItem'

    LineItem:
      x-has-dao: true
      required: [assignId, orderId, itemInstanceId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/LineItemInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            parentItemId:
              $ref: '#/components/schemas/LineItem'
            orderId:
              $ref: '#/components/schemas/OrderNew'
            itemInstanceId:
              $ref: '#/components/schemas/ItemInstance'
            subscriptionId:
              $ref: '#/components/schemas/PersonSubscription'
            classSignup:
              nullable: true
              $ref: '#/components/schemas/ClassSignup'
            membership:
              nullable: true
              $ref: '#/components/schemas/MembershipDAO'
            donation:
              nullable: true
              $ref: '#/components/schemas/DonationDAO'
            card:
              nullable: true
              $ref: '#/components/schemas/CardDAO'
            giftCard:
              nullable: true
              $ref: '#/components/schemas/BalanceTransaction'
            guestPrivs:
              nullable: true
              $ref: '#/components/schemas/GuestPrivsDAO'
            damageWaiver:
              nullable: true
              $ref: '#/components/schemas/DamageWaiver'
            stockChange:
              nullable: true
              $ref: '#/components/schemas/ItemInstanceStockChange'
            discounts:
              x-parent-variable: lineItemId
              type: array
              items:
                $ref: '#/components/schemas/LineItemDiscountInstance'
            refunds:
              x-parent-variable: lineItemId
              type: array
              items:
                $ref: '#/components/schemas/LineItemRefund'

    LineItemRefund:
      x-has-dao: true
      required: [assignId, lineItemId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/LineItemRefundInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            lineItemId:
              $ref: '#/components/schemas/LineItem'
            stockChangeId:
              $ref: '#/components/schemas/ItemInstanceStockChange'
            taxes:
              x-parent-variable: lineItemRefundId
              type: array
              items:
                $ref: '#/components/schemas/LineItemRefundTax'
    LineItemRefundTax:
      x-has-dao: true
      required: [taxId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/LineItemRefundTaxInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            lineItemRefundId:
              $ref: '#/components/schemas/LineItemRefund'
            taxId:
              $ref: '#/components/schemas/OrderTax'

    ItemTax:
      x-has-dao: true
      required: [assignId, itemId, taxId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/ItemTaxFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            itemId:
              $ref: '#/components/schemas/Item'
            taxId:
              $ref: '#/components/schemas/Tax'

    Tax:
      x-has-dao: true
      required: [assignId, taxName, taxRate, taxMinValueCents, catalogId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/TaxFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            catalogId:
              $ref: '#/components/schemas/Catalog'

    OrderTax:
      x-has-dao: true
      x-no-interface: true
      required: [assignId, taxId, order]
      allOf:
        - $ref: './shared.yaml#/components/schemas/OrderTaxFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            taxId:
              $ref: '#/components/schemas/Tax'
            orderId:
              $ref: '#/components/schemas/OrderNew'

    LineItemDiscountInstance:
      x-has-dao: true
      required: [assignId, lineItemId, discountInstanceId, discountType]
      allOf:
        - $ref: './shared.yaml#/components/schemas/LineItemDiscountInstanceInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            lineItemId:
              $ref: '#/components/schemas/LineItem'
            discountInstanceId:
              $ref: '#/components/schemas/DiscountInstance'

    OrderNew:
      x-has-dao: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/OrderFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          required: [assignId, status, version]
          properties:
            personId:
              $ref: '#/components/schemas/PersonDAO'
            lineItems:
              x-parent-variable: orderId
              items:
                $ref: '#/components/schemas/LineItem'
            appliedTaxes:
              x-parent-variable: orderId
              items:
                $ref: '#/components/schemas/OrderTax'
            orderPayments:
              x-parent-variable: orderId
              items:
                $ref: '#/components/schemas/OrderPayment'

    ItemDiscount:
      x-has-dao: true
      required: [assignId, itemId, discountId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/ItemDiscountFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            itemId:
              $ref: '#/components/schemas/Item'
            discountId:
              $ref: '#/components/schemas/Discount'
    PaymentSource:
      x-has-dao: true
      required: [ assignId, orderId, paymentSource, paymentAmountCents, paymentStatus ]
      allOf:
        - $ref: './shared.yaml#/components/schemas/PaymentSourceFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            personId:
              $ref: '#/components/schemas/PersonDAO'
            balanceSource:
              $ref: '#/components/schemas/Balance'

    OrderPayment:
      x-has-interface: true
      x-no-interface: true
      x-has-dao: true
      required: [assignId, orderId, paymentSource, paymentAmountCents, paymentStatus]
      allOf:
        - $ref: './shared.yaml#/components/schemas/OrderPaymentInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            orderId:
              $ref: '#/components/schemas/OrderNew'
            paymentSource:
              $ref: '#/components/schemas/PaymentSource'
            stripeTransaction:
              $ref: '#/components/schemas/StripeTransaction'
            cashTransaction:
              $ref: '#/components/schemas/CashTransaction'
            balanceTransaction:
              $ref: '#/components/schemas/BalanceTransaction'
            transactionOther:
              $ref: '#/components/schemas/TransactionOther'

    CustomPaymentMethodMapping:
      x-has-dao: true
      required: [assignId, paymentType, customPaymentMethodId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/CustomPaymentMethodMappingBase'
        - $ref: './shared.yaml#/components/schemas/LongIDResource'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
    BalanceTransaction:
      x-has-dao: true
      required: [assignId, balanceId, transactionAmountCents]
      allOf:
        - $ref: './shared.yaml#/components/schemas/BalanceTransactionInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            balanceId:
              $ref: '#/components/schemas/Balance'
            paymentId:
              $ref: '#/components/schemas/OrderPayment'
            lineItemId:
              x-backref-name: giftCard
              allOf:
                - $ref: '#/components/schemas/LineItem'
    TransactionOther:
      x-has-dao: true
      required: [ assignId, checkNumber, checkAmount ]
      allOf:
        - $ref: './shared.yaml#/components/schemas/TransactionOtherFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
    Balance:
      x-has-dao: true
      required: [assignId, personId, balanceCents, balanceType]
      allOf:
        - $ref: './shared.yaml#/components/schemas/BalanceInternal'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            personId:
              $ref: '#/components/schemas/PersonDAO'

    StripeTransaction:
      x-has-dao: true
      required: [assignId, stripePaymentIntent, transactionAmountCents]
      allOf:
        - $ref: './shared.yaml#/components/schemas/StripeTransactionInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            payments:
              type: array
              x-parent-variable: stripeTransaction
              items:
                $ref: '#/components/schemas/OrderPayment'

    CashTransaction:
      x-has-dao: true
      required: [assignId, cashDrawerId, transactionAmountCents]
      allOf:
        - $ref: './shared.yaml#/components/schemas/CashTransactionInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            paymentId:
              $ref: '#/components/schemas/OrderPayment'
            cashDrawerChangeId:
              $ref: '#/components/schemas/CashDrawersChange'

    CashDrawersChange:
      x-has-dao: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/CashDrawersChangeFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            cashDrawerId:
              $ref: '#/components/schemas/CashDrawer'
    ApClassType:
      x-has-dao: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/ApClassTypeRef'
        - $ref: './shared.yaml#/components/schemas/DBHistory'

    ApClassInstance:
      x-has-dao: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/ApClassInstanceRef'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
    ClassSignup:
      x-has-dao: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/ClassSignupInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            signupId:
              x-col-primary: true
              x-dto-column: SIGNUP_ID
              x-table-name: AP_CLASS_SIGNUPS
              x-auto-increment: AP_CLASS_SIGNUPS_SEQ
              type: integer
            personId:
              $ref: '#/components/schemas/PersonDAO'
            lineItemId:
              x-backref-name: classSignup
              allOf:
                - $ref: '#/components/schemas/LineItem'
            instanceId:
              $ref: '#/components/schemas/ApClassInstance'
    GuestPrivsDAO:
      x-has-dao: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/GuestPrivsInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            assignId:
              x-table-name: guest_privs
              x-col-primary: true
              type: integer
            membershipId:
              $ref: '#/components/schemas/MembershipDAO'
            lineItemId:
              x-backref-name: guestPrivs
              allOf:
                - $ref: '#/components/schemas/LineItem'
    DamageWaiver:
      x-has-dao: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/DamageWaiverInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            personId:
              $ref: '#/components/schemas/PersonDAO'
            lineItemId:
              x-backref-name: damageWaiver
              allOf:
                - $ref: '#/components/schemas/LineItem'
    PersonSubscription:
      x-has-dao: true
      required: [assignId, personId, subscriptionId, billingCycle]
      allOf:
        - $ref: './shared.yaml#/components/schemas/PersonSubscriptionFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            personId:
              $ref: '#/components/schemas/PersonDAO'
            subscriptionId:
              $ref: '#/components/schemas/Subscription'

    Subscription:
      x-has-dao: true
      required: [assignId, name, billingCycle]
      allOf:
        - $ref: './shared.yaml#/components/schemas/SubscriptionFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'

    SubscriptionItem:
      x-has-dao: true
      required: [assignId, subscriptionId, itemId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/SubscriptionItemFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            subscriptionId:
              $ref: '#/components/schemas/Subscription'
            itemId:
              $ref: '#/components/schemas/Item'

    PersonPhoneDAO:
      x-has-dao: true
      x-sub-type: Phone
      x-sub-variable: phoneId
      required: [personPhoneAssignId, personId, phoneId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/WithAccessControl'
        - $ref: './shared.yaml#/components/schemas/PersonPhoneFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            personPhoneAssignId:
              x-dto-column: assign_id
              x-table-name: person_phone
              x-col-primary: true
              type: integer
              format: int64
            personId:
              $ref: '#/components/schemas/PersonDAO'
            phoneId:
              $ref: '#/components/schemas/PhoneDAO'
    PhoneDAO:
      x-has-dao: true
      required: [assignId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/Phone'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            assignId:
              x-table-name: phone
              x-col-primary: true
              type: integer
              format: int64
            persons:
              type: array
              items:
                $ref: '#/components/schemas/PersonPhoneDAO'
    PersonAddressDAO:
      x-has-interface: true
      x-has-dao: true
      x-has-dto: false
      x-sub-type: Address
      x-sub-variable: addressId
      required: [personAddressAssignId, line1, country, personId, addressId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/WithAccessControl'
        - $ref: './shared.yaml#/components/schemas/PersonAddressFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            personAddressAssignId:
              x-dto-column: assign_id
              x-table-name: person_address
              x-col-primary: true
              type: integer
              format: int64
            personId:
              $ref: '#/components/schemas/PersonDAO'
            addressId:
              allOf:
                - $ref: '#/components/schemas/AddressDAO'
    AddressDAO:
      type: object
      x-has-dao: true
      required: [assignId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/Address'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            assignId:
              x-table-name: address
              x-col-primary: true
              type: integer
              format: int64
            persons:
              type: array
              items:
                $ref: '#/components/schemas/PersonAddressDAO'

    PersonReferralDAO:
      x-has-dao: true
      required: [personId, assignId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/PersonReferral'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            assignId:
              x-table-name: person_referral
              x-col-primary: true
              type: integer
              format: int64
            personId:
              $ref: '#/components/schemas/PersonDAO'

    MembershipType:
      x-has-dao: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/MembershipTypeRef'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
    #Person:
    #  x-already-exists: true
    #  required: [assignId]
    #  properties:
    #    id:
    #      type: integer
    DonationDAO:
      x-has-dao: true
      required: [donationId, fundId, initiativeId, state]
      allOf:
        - $ref: './shared.yaml#/components/schemas/DonationInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            fundId:
              $ref: '#/components/schemas/DonationFundDAO'
            initiativeId:
              $ref: '#/components/schemas/DonationInitiativeDAO'
            personId:
              $ref: '#/components/schemas/PersonDAO'
            lineItemId:
              x-backref-name: donation
              allOf:
                - $ref: '#/components/schemas/LineItem'
    DonationFundDAO:
      x-has-dao: true
      type: object
      allOf:
        - $ref: './shared.yaml#/components/schemas/DonationFundFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
    DonationInitiativeDAO:
      x-has-dao: true
      type: object
      allOf:
        - $ref: './shared.yaml#/components/schemas/DonationInitiativeFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
    PersonLegacy:
      x-has-dao: false
      x-dao-interface: true
      type: object
      properties:
        migrationStatus:
          type: string
          maxLength: 10
          nullable: true

        nameFirst:
          type: string
          maxLength: 100
          nullable: true

        nameMiddle:
          type: string
          maxLength: 5
          nullable: true

        nameLast:
          type: string
          maxLength: 100
          nullable: true

        namePrefix:
          type: string
          maxLength: 50
          nullable: true

        nameSuffix:
          type: string
          maxLength: 50
          nullable: true

        namePreferred:
          type: string
          maxLength: 100
          nullable: true

        parentEmail:
          type: string
          maxLength: 100
          nullable: true

        addr1:
          type: string
          maxLength: 200
          nullable: true
          x-dto-column: ADDR_1

        addr2:
          type: string
          maxLength: 200
          nullable: true
          x-dto-column: ADDR_2

        addr3:
          type: string
          maxLength: 200
          nullable: true
          x-dto-column: ADDR_3

        city:
          type: string
          maxLength: 50
          nullable: true

        state:
          type: string
          maxLength: 50
          nullable: true
          x-dto-column: STATE

        zip:
          type: string
          maxLength: 15
          nullable: true

        country:
          type: string
          maxLength: 50
          nullable: true

        phonePrimary:
          type: string
          maxLength: 100
          nullable: true

        phonePrimaryType:
          type: string
          maxLength: 50
          nullable: true

        phoneAlternate:
          type: string
          maxLength: 100
          nullable: true

        phoneAlternateType:
          type: string
          maxLength: 50
          nullable: true

        emerg1Name:
          type: string
          maxLength: 200
          nullable: true

        emerg1Relation:
          type: string
          maxLength: 50
          nullable: true

        emerg1PhonePrimary:
          type: string
          maxLength: 100
          nullable: true

        emerg1PhonePrimaryType:
          type: string
          maxLength: 50
          nullable: true

        emerg1PhoneAlternate:
          type: string
          maxLength: 100
          nullable: true

        emerg1PhoneAlternateType:
          type: string
          maxLength: 50
          nullable: true

        emerg2Name:
          type: string
          maxLength: 200
          nullable: true

        emerg2Relation:
          type: string
          maxLength: 50
          nullable: true

        emerg2PhonePrimary:
          type: string
          maxLength: 100
          nullable: true

        emerg2PhonePrimaryType:
          type: string
          maxLength: 50
          nullable: true

        emerg2PhoneAlternate:
          type: string
          maxLength: 100
          nullable: true

        emerg2PhoneAlternateType:
          type: string
          maxLength: 50
          nullable: true

        ethnicityOther:
          type: string
          maxLength: 100
          nullable: true

        pwHashScheme:
          type: string
          maxLength: 20
          nullable: true

        languageOther:
          type: string
          maxLength: 200
          nullable: true

        incomeLevel:
          type: integer
          format: int32
          nullable: true

        incomeAmt:
          type: integer
          format: int32
          nullable: true

        incomeAmtRaw:
          type: string
          maxLength: 50
          nullable: true

        badMail:
          type: string
          maxLength: 1
          nullable: true

        deceased:
          type: string
          maxLength: 1
          nullable: true

        doNotCall:
          type: string
          maxLength: 1
          nullable: true

        doNotEmail:
          type: string
          maxLength: 1
          nullable: true

        doNotMail:
          type: string
          maxLength: 1
          nullable: true

        employer:
          type: string
          maxLength: 100
          nullable: true

        referralSource:
          type: string
          maxLength: 200
          nullable: true

        badPhone:
          type: string
          maxLength: 1
          nullable: true

        badEmail:
          type: string
          maxLength: 1
          nullable: true

        referralOther:
          type: string
          maxLength: 100
          nullable: true

        jpAgeOverride:
          type: string
          maxLength: 1
          nullable: true

        sendAlert:
          type: string
          maxLength: 1
          nullable: true

        ignoreJpMinAge:
          type: string
          maxLength: 1
          nullable: true

        uapInterestedLessons:
          type: string
          maxLength: 1
          nullable: true

        uapInterestedRides:
          type: string
          maxLength: 1
          nullable: true

        entityType:
          type: string
          maxLength: 1
          nullable: true

        jpTeamId:
          type: integer
          format: int32
          nullable: true

        guestPortalReg:
          type: string
          maxLength: 1
          nullable: true

        signoutBlockReason:
          type: string
          nullable: true

        campFair:
          type: string
          maxLength: 50
          nullable: true

        dataUnconfirmed:
          type: string
          maxLength: 1
          nullable: true

        protopersonCookie:
          type: string
          maxLength: 50
          nullable: true

        protoState:
          type: string
          maxLength: 1
          nullable: true

        veteranEligible:
          type: string
          maxLength: 1
          nullable: true

        sailingExp:
          type: string
          maxLength: 100
          nullable: true

        orgContact:
          type: string
          maxLength: 200
          nullable: true

        memberComment:
          type: string
          nullable: true

        slackUserId:
          type: string
          maxLength: 20
          nullable: true

        squareCustomerId:
          type: string
          maxLength: 50
          nullable: true

        defaultCardId:
          type: string
          maxLength: 50
          nullable: true
    PersonDAO:
      x-has-dao: true
      required: [personId, relationsA, relationsB]
      allOf:
        - $ref: './shared.yaml#/components/schemas/PersonInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - $ref: '#/components/schemas/PersonLegacy'
        - type: object
          properties:
            assignId:
              x-table-name: persons
              x-col-primary: true
              x-dto-column: PERSON_ID
              x-auto-increment: PERSONS_SEQ
              type: integer
            relationsA:
              x-parent-variable: B
              x-column-parent-fk: A
              type: array
              items:
                $ref: '#/components/schemas/PersonRelationDAO'
            pwHash:
              type: string
              maxLength: 100
            relationsB:
              x-parent-variable: A
              x-column-parent-fk: B
              type: array
              items:
                $ref: '#/components/schemas/PersonRelationDAO'
            memberships:
              x-parent-variable: personId
              type: array
              items:
                $ref: '#/components/schemas/MembershipDAO'
            cards:
              x-optional-ref: true
              x-parent-variable: personId
              type: array
              items:
                $ref: '#/components/schemas/CardDAO'
            referrals:
              type: array
              x-parent-variable: personId
              items:
                $ref: '#/components/schemas/PersonReferralDAO'
            addresses:
              x-parent-variable: personId
              type: array
              items:
                $ref: '#/components/schemas/PersonAddressDAO'
            phones:
              x-parent-variable: personId
              type: array
              items:
                $ref: '#/components/schemas/PersonPhoneDAO'

    MembershipDAO:
      x-has-dao: true
      required: [assignId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/MembershipInternal'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            assignId:
              x-table-name: persons_memberships
              x-auto-increment: PERSONS_MEMBERSHIPS_SEQ
              x-col-primary: true
              type: integer
            membershipTypeId:
              $ref: "#/components/schemas/MembershipType"
            personId:
              $ref: '#/components/schemas/PersonDAO'
            lineItemId:
              x-backref-name: membership
              allOf:
                - $ref: '#/components/schemas/LineItem'
            guestPrivs:
              x-backref-name: membershipId
              allOf:
                - $ref: '#/components/schemas/GuestPrivsDAO'
    CardDAO:
      x-has-dao: true
      required: [ assignId ]
      allOf:
        - $ref: './shared.yaml#/components/schemas/CardInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            assignId:
              x-table-name: persons_cards
              x-auto-increment: PERSONS_CARDS_SEQ
              x-col-primary: true
              type: integer
            personId:
              $ref: '#/components/schemas/PersonDAO'
            lineItemId:
              x-backref-name: card
              allOf:
                - $ref: '#/components/schemas/LineItem'
    PersonRelationDAO:
      x-has-dao: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/WithAccessControl'
        - $ref: './shared.yaml#/components/schemas/PersonRelation'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          required: [A, B, relationId]
          properties:
            relationId:
              type: integer
              x-auto-increment: PERSON_RELATIONSHIPS_SEQ
              x-col-primary: true
              x-table-name: person_relationships
            A:
              x-dto-column: A
              allOf:
                - $ref: '#/components/schemas/PersonDAO'
            B:
              x-dto-column: B
              allOf:
                - $ref: '#/components/schemas/PersonDAO'



    DiscountInstance:
      x-has-dao: true
      required: [instanceId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/DiscountInstanceInternalFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            discountId:
              $ref: '#/components/schemas/Discount'

    Discount:
      x-has-dao: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/DiscountFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'
        - type: object
          properties:
            catalogId:
              $ref: '#/components/schemas/Catalog'
            categories:
              x-parent-variable: discountId
              type: array
              items:
                $ref: '#/components/schemas/DiscountCategory'
            instances:
              x-parent-variable: discountId
              type: array
              items:
                $ref: '#/components/schemas/DiscountInstance'

    CashDrawer:
      x-has-dao: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/CashDrawerFull'
        - $ref: './shared.yaml#/components/schemas/DBHistory'