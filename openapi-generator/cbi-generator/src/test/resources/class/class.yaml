openapi: 3.0.3
info:
  version: 1.0.0
  title: Class
paths:
  /classes/signup:
    post:
      description: 'Signs up for a class'
      security:
        - staff: [ ]
        - member: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClassSignupRequestDTO'
      responses:
        '200':
          description: Successfully returns the updated catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClassSignupResponseDTO'

  /ap-class/get-eligible/{personId}:
    get:
      summary: Get eligible classes
      description: Gets eligible class information for the supplied person_id
      security:
        - member: [ ]
      parameters:
        - in: path
          name: personId # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            minimum: 1
          description: The person id
      responses:
        '200':
          description: Successfully fetched classes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APEligibleClass'
        '204':
          description: No classes to show
        '401':
          description: Invalid credentials
        '403':
          description: Invalid permissions

  /ap-class/get-future/{personId}:
    get:
      x-serve-example: true
      summary: Get eligible classes
      description: Gets eligible class information for the supplied person_id
      parameters:
        - in: path
          name: personId # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            minimum: 1
          description: The person id
      responses:
        '200':
          description: Successfully fetched classes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APFutureClass'
        '204':
          description: No classes to show
        '401':
          description: Invalid credentials
        '403':
          description: Invalid permissions

  /ap-class/enroll/{id}: #EVAN TEST CODE; AUDIT THOROUGHLY
    post:
      parameters:
        - in: path
          name: id # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            minimum: 1
          description: The class id
      #x-serve-example: true
      summary: Enroll person into class
      description: Posts person_id and class_instance_id
      security:
        - member: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/APClassEnroll'
      responses:
        '202':
          description: TEST OK
components:
  schemas:
    ClassSignupResponseDTO:
      type: object
      properties:
        classSignup:
          $ref: '../shop/order.yaml#/components/schemas/PurchaseClassSignupDTO'
        errors:
          type: string
    ClassSignupRequestDTO:
      type: object
      properties:
        classSignup:
          $ref: '../shop/order.yaml#/components/schemas/PurchaseClassSignupDTO'
        overrides:
          $ref: '#/components/schemas/ClassSignupOverrides'
    ClassSignupOverrides:
      type: object
      properties:
        overrideCanEnroll:
          type: boolean
        overrideClassStarted:
          type: boolean
        overrideClassCancelled:
          type: boolean
        typeOverride:
          type: string
          maxLength: 1
          minLength: 1
    APEligibleClass:
      type: object
      properties:
        instanceId:
          type: integer
          example: 117
        typeName:
          type: string
          example: Intermediate 2
        sessionCount:
          type: integer
          example: 2
        sessionDates:
          type: array
          example: [ 01-APR-2010, 02-APR-2010 ]
          items:
            type: string
            format: date
        signupsAvailable:
          type: boolean
          example: T
        nextSignupsOpen:
          type: string
          format: date-time
        nextSignupsCount:
          type: integer
          example: 10
        instructor:
          type: string
          example: Joe L.
        location:
          type: string
          example: Dockhouse
        booleanEnumTest:
          $ref: '../shared.yaml#/components/schemas/Boolean'
          example: 'T'
    APFutureClass:
      type: object
      properties:
        enumTest:
          $ref: "../shared.yaml#/components/schemas/EnumTest"
          example: 'A'
        instanceId:
          type: integer
          example: 117
        typeName:
          type: string
          example: Intermediate 2
        sessionCount:
          type: integer
          example: 2
        sessionDates:
          type: array
          example: [ 01-APR-2010, 02-APR-2010 ]
          items:
            type: string
            format: date
        sessionLengthMinutes:
          type: integer
          example: 120
        signupsAvailable:
          type: boolean
          example: Y
        nextSignupsOpen:
          type: string
          format: date-time
        nextSignupsCount:
          type: integer
          example: 10
        instructor:
          type: string
          example: Joe L.
        location:
          type: string
          example: Dockhouse
    APClassEnroll:
      type: object
      properties:
        personId:
          type: integer
          example: 192535
        instanceId:
          type: integer
          example: 117