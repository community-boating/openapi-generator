openapi: 3.0.3
info:
  title: Simple API with JWT Auth
  version: 1.0.0
  description: A minimal OpenAPI spec with JWT authentication and simple models.

servers:
  - url: https://api.example.com

paths:
  /paths/test:
    get:
      parameters:
        - in: query
          name: id # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserTest'
  /users/me/{id}/{test}:
    get:
      summary: Get current user
      description: Returns the details of the currently authenticated user.
      security:
        - staff: []
      parameters:
        - in: path
          name: id # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            minimum: 1
          description: The user ID
        - in: path
          name: test # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            minimum: 1
          description: Test
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserTest'
        '401':
          description: Unauthorized
  /member/getNoParams:
    get:
      summary: Test
      description: Tests Post.
      responses:
        '200':
          description: All good
          content: 
            application/json:
              schema:
                $ref: './shared.yaml#/components/schemas/Boolean'
  
  /member/info:
    post:
      summary: Test
      description: Tests Post.
      security:
        - member: []
      tags:
        - Member
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PersonPublicParentDTO'
      responses:
        '200':
          description: Successful login
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonPublicParentDTO'
        '401':
          description: Invalid credentials
    get:
      summary: Test
      description: Tests Post.
      security:
        - member: []
      tags:
        - Member
      responses:
        '200':
          description: Successful login
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonPublicParentDTO'
        '401':
          description: Invalid credentials
  /member/test:
    post:
      summary: Test
      description: Tests Post.
      security:
        - member: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestRequest'
      responses:
        '200':
          description: Successful login
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestResponse'
        '401':
          description: Invalid credentials
  /staff/balance/{number}:
    get:
      security:
        - staff: []
      tags:
        - Balance
      parameters:
        - in: path
          name: number
          required: true
          schema:
            type: string
          description: The balance number
      responses:
        '200':
          description: Updated balance dto
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BalanceDTO'
  /member/balance/{number}:
    get:
      security:
        - member: []
      tags:
        - Balance
      parameters:
        - in: path
          name: number
          required: true
          schema:
            type: string
          description: The balance number
      responses:
        '200':
          description: Updated balance dto
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BalanceDTO'
  /staff/balances: 
    get:
      summary: Gets a list of balances
      security:
        - staff: []
      tags:
        - Balance
      x-is-paginated: true
      parameters:
        - in: query
          name: personId
          required: false
          schema:
            type: integer
            minimum: 1
          description: The owner of the balance
      responses:
        '200':
          description: Successful fetch of balances
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BalanceDTO'
    post:
      summary: Updated or creates a balance
      security:
        - staff: []
      tags:
        - Balance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BalanceDTO'
      responses:
        '200':
          description: Updated balance dto
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BalanceDTO'

  /ap-class/get-eligible/{personId}:
    get:
      summary: Get eligible classes
      description: Gets eligible class information for the supplied person_id
      security:
        - member: []
      parameters:
        - in: path
          name: personId # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            minimum: 1
          description: The person id
      responses:
        '200':
          description: Successfully fetched classes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APEligibleClass'
        '204' :
          description: No classes to show
        '401' :
          description: Invalid credentials
        '403' :
          description: Invalid permissions

  /ap-class/get-future/{personId}:
    get:
      x-serve-example: true
      summary: Get eligible classes
      description: Gets eligible class information for the supplied person_id
      parameters:
        - in: path
          name: personId # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            minimum: 1
          description: The person id
      responses:
        '200':
          description: Successfully fetched classes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APFutureClass'
        '204' :
          description: No classes to show
        '401' :
          description: Invalid credentials
        '403' :
          description: Invalid permissions

  /ap-class/enroll/{id}: #EVAN TEST CODE; AUDIT THOROUGHLY
    post:
      parameters:
        - in: path
          name: id # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            minimum: 1
          description: The class id
      #x-serve-example: true
      summary: Enroll person into class
      description: Posts person_id and class_instance_id
      security:
        - member: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/APClassEnroll'
      responses:
        '202':
          description: TEST OK
  /staff/compass-order/{id}:
    get:
      description: 'Gets an existing order by id'
      parameters:
        - in: path
          name: id # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
          description: The order id
      security:
        - staff: []
      tags:
        -  CompassOrder
      responses:
        '200':
          description: Successfully updated/inserted order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderWithDiscountsDTO'
  /staff/compass-order:
    post:
      description: 'Updates or inserts order and subobjects into the database for further use in the order system'
      parameters: []
      security:
        - staff: []
      tags:
        -  CompassOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderDTO'
      responses:
        '200':
          description: Successfully updated/inserted order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderWithDiscountsDTO'
  /member/compass-order/{id}:
    get:
      parameters:
        - in: path
          name: id # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
          description: The order id
      tags:
        -  CompassOrder
      security:
        - member: []
      description: 'Returns the current order this person has open'
      responses:
        '200':
          description: Successfully updated/inserted order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDTO'
        '404':
          description: Order doesn't exist
  /member/compass-order/open:
    get:
      tags:
        -  CompassOrder
      security:
        - member: []
      description: 'Returns the current order this person has open'
      responses:
        '200':
          description: Successfully updated/inserted order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDTO'
        '404':
          description: Order doesn't exist
  /member/compass-order:
    post:
      description: 'Updates or inserts order and subobjects into the database for further use in the order system'
      parameters: []
      security:
        - member: []
      tags:
        -  CompassOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderDTO'
      responses:
        '200':
          description: Successfully updated/inserted order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDTO'
  /orders/{id}/poll:
    parameters:
        - in: path
          name: id # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
          description: The order ID
    post:
      description: 'Polls order'
      tags:
        - CompassOrder
      responses:
        '200':
          description: Successfully cancelled the order
          content:
            application/json:
              schema:
                $ref: './shared.yaml#/components/schemas/OrderStateNew'
  /member/orders/cancel:
    post:
      description: 'Cancels current person order, deleting if possible'
      security:
        - member: []
      tags:
        - CompassOrder
      responses:
        '200':
          description: Successfully cancelled the order
  /staff/orders/cancel/{id}:
    post:
      description: 'Cancels an order, deleting if possible'
      parameters:
        - in: path
          name: id # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
          description: The order ID
      security:
        - staff: []
      tags:
        - CompassOrder
      responses:
        '200':
          description: Successfully cancelled the order
  /catalog/syncClasses:
    post:
      description: 'Syncs the current catalog with prices from the db'
      x-one-of-permissions:
        - 
          scope: admin
          type: ADMIN
      tags:
        - Catalog
      security:
        - staff: []
      responses:
        '200':
          description: Successfully syncs the catalog
  /catalog/inventory:
    get:
      description: 'Gets the current inventory'
      tags:
        - Catalog
      responses:
        '200':
          description: Successfully gets the inventory
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ItemStockDTO'
  /catalog/inventory/{id}:
    get:
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      description: 'Gets the current catalog'
      tags:
        - Catalog
      responses:
        '200':
          description: Successfully gets the catalog
          content:
            application/json:
              schema:
                type: integer
    post:
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      description: 'Updates the quantity of a specified item'
      x-one-of-permissions:
        - 
          scope: admin
          type: ADMIN
      tags:
        - Catalog
      security:
        - staff: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StockChangeDTO'
      responses:
        '200':
          description: Successfully syncs the catalog
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ItemStockDTO'
  
  /catalog:
    get:
      description: 'Gets the current catalog'
      tags:
        - Catalog
      responses:
        '200':
          description: Successfully gets the catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogDTO'
  /staff/catalog:
    get:
      description: 'Gets the current catalog'
      tags:
        - Catalog
      responses:
        '200':
          description: Successfully gets the catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogDTO'
    post:
      description: 'Updates the current catalog'
      x-one-of-permissions:
        - 
          scope: admin
          type: ADMIN
      tags:
        - Catalog
      security:
        - staff: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CatalogDTO'
      responses:
        '200':
          description: Successfully returns the updated catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogDTO'
  /classes/signup:
    post:
      description: 'Signs up for a class'
      security:
          - staff: []
          - member: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClassSignupRequestDTO'
      responses:
        '200':
          description: Successfully returns the updated catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClassSignupResponseDTO'
  /stripe/constants:
    get:
      description: 'Returns stripe constants'
      tags:
        - Stripe
      responses:
        '200':
          description: Successfully returns the stripe constants
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StripeConstantsDTO'
  /staff/personNew/test:
    get:
      tags:
        - Member
      security:
        - staff: []
      description: 'Test new person dto'
      responses:
        '200':
          description: 'Success'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonDTO'

  /staff/payment:
    post:
      security:
        - staff: []
      description: 'Creates test payment intent'
      tags:
        - Payment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderPaymentDTO'
      responses:
        '200':
          description: Returns payment intent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderPaymentDTO'
  /member/checkout-session:
    get:
      security:
        - member: []
      tags:
        - Payment
      description: 'Creates a payment intent'
      responses:
        '200':
          description: Returns payment intent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckoutSessionDTO'
  /member/payment/cancel/{id}:
    post:
      security:
        - member: []
      parameters:
        - in: path
          name: id # Note the name is the same as in the path
          required: true
          schema:
            type: integer
            minimum: 1
      description: 'Cancels a payment'
      tags:
        - Payment
      responses:
        '200':
          description: Returns payment intent
  /member/payment:
    post:
      security:
        - member: []
      description: 'Creates a payment intent'
      tags:
        - Payment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderPaymentDTO'
      responses:
        '200':
          description: Returns payment intent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderPaymentDTO'
  /stripe/paymentTest:
    post:
      security:
        - member: []
      description: 'Creates test payment intent'
      tags:
        - Stripe
      responses:
        '200':
          description: Returns payment intent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentTestDTO'
components:
  securitySchemes:
    staff:
      type: http
      scheme: bearer
      bearerFormat: JWT
    member:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    StockChangeDTO:
      properties:
        stockChangeType:
          $ref: './shared.yaml#/components/schemas/StockChangeType'
        changeAmount:
          type: integer
    ItemStockDTO:
      properties:
        itemInstanceId:
          type: integer
          format: int64
        itemName:
          type: string
        stockAmountRemaining:
          type: integer
        stockAmountSold:
          type: integer
        stockAmountRefunded:
          type: integer
    PaymentTestDTO:
      properties:
        clientSecret:
          type: string
        sessionClientSecret:
          type: string
    StripeConstantsDTO:
      required: [publicKey, account, apiVersion, locale]
      properties:
        publicKey:
          type: string
        account:
          type: string
        apiVersion:
          type: string
        locale:
          type: string
        
    CashTransaction:
      required: [id, cashDrawerId, transactionAmountCents]
      properties:
        id:
          type: integer
          format: int64
        cashDrawerId:
          type: integer
        transactionAmountCents:
          type: integer
          format: int64
        cashDrawerChange:
          $ref: '#/components/schemas/CashDrawersChangeDTO'
    CashDrawersChangeDTO:
      required: [id, changeType, changeAmountCents]
      properties:
        id:
          type: integer
        changeType:
          type: string
          maxLength: 50
        changeAmountCents:
          type: integer
          format: int64
    BalanceTransactionDTO:
      required: [id, balanceId, transactionAmountCents]
      properties:
        assignId:
          type: integer
          format: int64
        balanceTransactionType:
          $ref: './shared.yaml#/components/schemas/BalanceTransactionType'
        paymentId:
          type: integer
          format: int64
        transactionAmountCents:
          type: integer
          format: int64
        purchasableState:
          readOnly: true
          allOf:
            - $ref: './shared.yaml#/components/schemas/PurchasableState'
        lineItemId:
          type: integer
          format: int64
    BalanceDTO:
      required: [balanceCents, balanceType]
      properties:
        assignId:
          type: integer
          format: int64
        balanceAccountNumber:
          type: string
        balanceAccountToken:
          writeOnly: true
          type: string
          maxLength: 64
          minLength: 64
        balanceCents:
          readOnly: true
          type: integer
          format: int64
        balanceType:
          $ref: './shared.yaml#/components/schemas/BalanceType'
        balanceOwner:
          type: integer
        balanceTransactions:
          type: array
          items:
            $ref: '#/components/schemas/BalanceTransactionDTO'
    ClassSignupResponseDTO:
      type: object
      properties:
        classSignup:
          $ref: '#/components/schemas/PurchaseClassSignupDTO'
        errors:
          type: string
    ClassSignupRequestDTO:
      type: object
      properties:
        classSignup:
          $ref: '#/components/schemas/PurchaseClassSignupDTO'
        overrides:
          $ref: '#/components/schemas/ClassSignupOverrides'
    ClassSignupOverrides:
      type: object
      properties:
        overrideCanEnroll:
          type: boolean
        overrideClassStarted:
          type: boolean
        overrideClassCancelled:
          type: boolean
        typeOverride:
          type: string
          maxLength: 1
          minLength: 1
    ValidateLineItemOverrides:
      type: object
      properties:
        overrideValidPeople:
          type: boolean
        overrideTypeCheck:
          type: boolean
        ClassSignupOverrides:
          $ref: '#/components/schemas/ClassSignupOverrides'
    CatalogDTO:
      type: object
      properties:
        assignId:
          type: integer
          format: int64
        startActive:
          type: string
          format: date-time
        endActive:
          type: string
          format: date-time
        catalogName:
          type: string
          maxLength: 200
        items:
          type: array
          items:
            $ref: '#/components/schemas/CatalogItemDTO'
        taxes:
          type: array
          items:
            $ref: '#/components/schemas/CatalogTaxDTO'
        categories:
          type: array
          items:
            $ref: '#/components/schemas/CatalogCategoryDTO'
        discounts:
          type: array
          items:
            $ref: '#/components/schemas/CatalogDiscountDTO'
        products:
          type: array
          items:
            $ref: '#/components/schemas/CatalogProductDTO'
    CatalogTaxDTO:
      required: [taxName, taxRate, taxMinValueCents]
      properties:
        assignId:
          type: integer
          format: int64
        taxName:
          type: string
          maxLength: 200
        taxCode:
          type: string
          maxLength: 500
        taxRate:
          type: string
          maxLength: 200
        taxBeforeDiscount:
          type: boolean
        taxMinValueCents:
          type: integer
          format: int64
    CatalogDiscountCategoryDTO:
      required: [discountId]
      properties:
        assignId:
          type: integer
          format: int64
        categoryId:
          type: integer
          format: int64
    CatalogCategoryDTO:
      required: [categoryName, description]
      properties:
        assignId:
          type: integer
          format: int64
        categoryName:
          type: string
          maxLength: 200
        categoryType:
          $ref: './shared.yaml#/components/schemas/CategoryType'
        description:
          type: string
          maxLength: 500
    CatalogDiscountDTO:
      required: [discountName]
      properties:
        discountId:
          type: integer
        discountName:
          type: string
          maxLength: 100
        categories:
          type: array
          items:
            $ref: '#/components/schemas/CatalogDiscountCategoryDTO'
        instances:
          type: array
          items:
            $ref: '#/components/schemas/CatalogDiscountInstanceDTO'
    CatalogDiscountInstanceDTO:
      required: [discountType]
      properties:
        discountType:
          $ref: './shared.yaml#/components/schemas/DiscountType'
        instanceId:
          type: integer
        amountCents:
          type: integer
          format: int64
        percent:
          type: string
        autoApply:
          type: boolean
        isGlobal:
          type: boolean
        isSpecial:
          type: boolean
        startActive:
          type: string
          format: date
        universalCode:
          writeOnly: true
          type: string
          maxLength: 200
        endActive:
          type: string
          format: date
    CatalogItemInstanceDTO:
      type: object
      properties:
        assignId:
          type: integer
          format: int64
        priceCents:
          type: integer
          format: int64
          example: 12
        startActive:
          type: string
          format: date-time
        endActive:
          type: string
          format: date-time
    CatalogItemDTO:
      required: [type]
      properties:
        assignId:
          type: integer
          format: int64
        itemType:
          nullable: false
          $ref: './shared.yaml#/components/schemas/ItemType'
        classTypeId:
          nullable: true
          type: integer
        classInstanceId:
          nullable: true
          type: integer
        membershipTypeId:
          nullable: true
          type: integer
        productId:
          nullable: true
          type: integer
          format: int64
        itemName:
          nullable: true
          type: string
          maxLength: 200
        itemDescription:
          nullable: true
          type: string
          maxLength: 500
        imageURL:
          nullable: true
          type: string
          maxLength: 200
        itemSKU:
          nullable: true
          type: string
          maxLength: 500
        maxQuantity:
          type: integer
        minQuantity:
          type: integer
        allowPriceOverride:
          type: boolean
        priceOverrideMin:
          type: integer
          format: int64
        priceOverrideMax:
          type: integer
          format: int64
        squareItemId:
          type: string
          maxLength: 200
        itemInstances:
          type: array
          items:
            $ref: '#/components/schemas/CatalogItemInstanceDTO'
        itemDiscounts:
          type: array
          items:
            $ref: '#/components/schemas/CatalogItemDiscountDTO'
        itemTaxes:
          type: array
          items:
            $ref: '#/components/schemas/CatalogItemTaxDTO'
        itemCategories:
          type: array
          items:
            $ref: '#/components/schemas/CatalogItemCategoryDTO'
    CatalogItemDiscountDTO:
      properties:
        assignId:
          type: integer
          format: int64
        discountType:
          $ref: './shared.yaml#/components/schemas/DiscountType'
        requiresParentEligibility:
          type: boolean
        amountCents:
          type: integer
          format: int64
        percent:
          type: string
        discountId:
          type: integer
    CatalogItemTaxDTO:
      properties:
        assignId:
          type: integer
          format: int64
        taxId:
          type: integer
          format: int64

    CatalogItemCategoryDTO:
      required: [categoryId]
      properties:
        assignId:
          type: integer
          format: int64
        categoryId:
          type: integer
          format: int64
    CatalogProductDTO:
      required: [productName, productDescription, active]
      properties:
        assignId:
          type: integer
          format: int64
        productName:
          type: string
          maxLength: 200
        productDescription:
          type: string
          maxLength: 500
        active:
          type: boolean
    CatalogSubscriptionDTO:
      required: [name, billingCycle]
      properties:
        assignId:
          type: integer
          format: int64
        name:
          type: string
          maxLength: 200
        billingCycle:
          type: string
          maxLength: 50
        items:
          type: array
          items:
            $ref: '#/components/schemas/CatalogSubscriptionItemDTO'
    CatalogSubscriptionItemDTO:
      required: [itemId]
      properties:
        assignId:
          type: integer
          format: int64
        itemId:
          type: integer
          format: int64
        cyclePriceOverrideCents:
          type: integer
          format: int64
    OrderWithDiscountsDTO:
      type: object
      properties:
        order:
          $ref: '#/components/schemas/OrderDTO'
        availableDiscounts:
          type: array
          items:
            $ref: '#/components/schemas/LineItemAvailableDiscount'
    LineItemAvailableDiscount:
      type: object
      properties:
        lineItemId:
          type: integer
          format: int64
        discountId:
          type: integer
        instanceId:
          type: integer
        discountType:
          $ref: './shared.yaml#/components/schemas/DiscountType'
        amountCents:
          type: integer
          format: int64
        percent:
          type: string
        discountName:
          type: string
    OrderSummaryDTO:
      type: object
      required: [lineItems, orderNum]
      properties:
        assignId:
          nullable: true
          type: integer
          format: int64
          example: 12
        orderSource:
          readOnly: true
          allOf:
            - $ref: './shared.yaml#/components/schemas/OrderSource'
        orderStatus:
          $ref: './shared.yaml#/components/schemas/OrderStateNew'
          readOnly: true
        personId:
          type: integer
          example: 12
        #itemCount:
        #  type: integer
        version:
          type: integer
    OrderDTO:
      type: object
      required: [lineItems, orderNum, version]
      properties:
        assignId:
          nullable: true
          type: integer
          format: int64
          example: 12
        orderSource:
          readOnly: true
          allOf:
            - $ref: './shared.yaml#/components/schemas/OrderSource'
        amountServiceChangeCents:
          description: Total cost of service charges (Payment fees paid by customer, maybe we will add restock service fee?)
          readOnly: true
          type: integer
          format: int64
        amountBaseCents:
          description: Total of all items before discounts
          readOnly: true
          type: integer
          format: int64
        amountDiscountsCents:
          description: Total of all discounts applied
          readOnly: true
          type: integer
          format: int64
        amountTaxesCents:
          description: Total of all taxes applied
          readOnly: true
          type: integer
          format: int64
        amountTotalCents:
          description: Total of all items with discounts and taxes
          readOnly: true
          type: integer
          format: int64
        amountPendingCents:
          description: Total of all pending payments
          readOnly: true
          type: integer
          format: int64
        amountRefundedCents:
          description: Total of all refunded payments
          readOnly: true
          type: integer
          format: int64
        amountToRefundCents:
          description: Total of all refunded items
          readOnly: true
          type: integer
          format: int64
        amountToPayCents:
          description: Total of all non-refunded items
          readOnly: true
          type: integer
          format: int64
        amountPaidCents:
          description: Total of all successful payments
          readOnly: true
          type: integer
          format: int64
        orderStatus:
          $ref: './shared.yaml#/components/schemas/OrderStateNew'
          readOnly: true
        personId:
          type: integer
          example: 12
        #itemCount:
        #  type: integer
        version:
          type: integer
        lineItems:
          type: array
          items:
            $ref: '#/components/schemas/LineItemDTO'
        appliedTaxes:
          type: array
          readOnly: true
          items:
            $ref: '#/components/schemas/OrderTaxDTO'
        orderPayments:
          type: array
          readOnly: true
          items:
            $ref: '#/components/schemas/OrderPaymentDTO'
        deleted:
          readOnly: true
          type: boolean
    CheckoutSessionDTO:
      type: object
      properties:
        checkoutSecret:
          type: string
    CreateOrderPaymentDTO:
      type: object
      required: [orderId, payment]
      properties:
        orderId:
          type: integer
          format: int64
        payment:
          $ref: '#/components/schemas/OrderPaymentDTO'
        saveCard:
          type: boolean
    OrderPaymentDTO:
      type: object
      properties:
        assignId:
          type: integer
          format: int64
        paymentType:
          nullable: false
          $ref: './shared.yaml#/components/schemas/PaymentType'
        paymentSource:
          type: string
          maxLength: 100
        paymentServiceChangeCents:
          type: integer
          format: int64
        paymentPaidCents:
          readOnly: true
          type: integer
          format: int64
        paymentTotalCents:
          type: integer
          format: int64
        paymentRefundedCents:
          readOnly: true
          type: integer
          format: int64
        paymentToRefundCents:
          type: integer
          format: int64
        paymentStatus:
          nullable: false
          $ref: './shared.yaml#/components/schemas/PaymentStatus'
        paymentDueDate:
          nullable: true
          type: string
          format: date-time
        stripeTransaction:
          nullable: true
          $ref: '#/components/schemas/StripeTransactionDTO'
        BalanceTransaction:
          nullable: true
          $ref: '#/components/schemas/BalanceTransactionDTO'

    StripeTransactionDTO:
      required: [id, stripePaymentIntent, transactionAmountCents]
      properties:
        assignId:
          type: integer
          format: int64
        transactionType:
          $ref: './shared.yaml#/components/schemas/StripeTransactionType'
        stripePaymentIntent:
          type: string
          readOnly: true
          maxLength: 500
        stripePaymentSecret:
          type: string
          readOnly: true
          maxLength: 500
        transactionAmountCents:
          readOnly: true
          type: integer
          format: int64
    OrderTaxDTO:
      type: object
      properties:
        assignId:
          type: integer
          format: int64
        taxId:
          type: integer
          format: int64
        amountTotalCents:
          readOnly: true
          type: integer
          format: int64
        amountPaidCents:
          readOnly: true
          type: integer
          format: int64
        amountToRefundCents:
          readOnly: true
          type: integer
          format: int64
        amountRefundedCents:
          readOnly: true
          type: integer
          format: int64
        taxRateUsed:
          readOnly: true
          type: string
          maxLength: 200
    LineItemDTO:
      type: object
      properties:
        assignId:
          nullable: false
          type: integer
          format: int64
        referenceId:
          type: string
          maxLength: 200
        parentItemId:
          type: integer
          format: int64
        itemInstanceId:
          type: integer
          format: int64
          nullable: false
        subscriptionId:
          nullable: true
          type: integer
          format: int64
        amountBaseCents:
          description: Base cost of a single unit of this line item (From catalog or amount specified, if allowed)
          readOnly: true
          type: integer
          format: int64
        amountSpecifiedCents:
          description: Specified cost of a single unit of this line item(For catalog items that support variable pricing)
          type: integer
          format: int64
        amountDiscountsBaseCents:
          description: Total value (in cents) of all discounts applied to a single unit of this line item
          readOnly: true
          type: integer
          format: int64
        amountDiscountsTotalCents:
          description: Total value (in cents) of all discounts applied to all units of this line item
          readOnly: true
          type: integer
          format: int64
        amountTotalCents:
          description: Base price of line item times quantity minus value of all discounts (in cents)
          readOnly: true
          type: integer
          format: int64
        amountToRefundCents:
          description: Amount of money to refund (in cents)
          readOnly: true
          type: integer
          format: int64
        amountRefundedCents:
          description: Amount of money successfully refunded
          readOnly: true
          type: integer
          format: int64
        amountPaidCents:
          description: Amount of money successfully paid
          readOnly: true
          type: integer
          format: int64
        classSignup:
          nullable: true
          $ref: '#/components/schemas/PurchaseClassSignupDTO'
        membership:
          nullable: true
          $ref: '#/components/schemas/PurchaseMembershipDTO'
        donation:
          nullable: true
          $ref: '#/components/schemas/PurchaseDonationDTO'
        card:
          nullable: true
          $ref: '#/components/schemas/PurchaseCardDTO'
        giftCard:
          nullable: true
          $ref: '#/components/schemas/PurchaseGiftCardDTO'
        guestPrivs:
          nullable: true
          $ref: '#/components/schemas/PurchaseGuestPrivilegesDTO'
        damageWaiver:
          nullable: true
          $ref: '#/components/schemas/PurchaseDamageWaiverDTO'
        stockChange:
          nullable: true
          $ref: '#/components/schemas/PurchaseStockedItemDTO'
        discounts:
          type: array
          items:
            $ref: '#/components/schemas/LineItemDiscountDTO'
        refunds:
          type: array
          items:
            $ref: '#/components/schemas/LineItemRefundDTO'
        deleted:
          readOnly: true
          type: boolean
    LineItemDiscountDTO:
      properties:
        assignId:
          nullable: false
          type: integer
          format: int64
        appliedCode:
          type: string
        isApplied:
          type: boolean
        discountInstanceId:
          nullable: false
          type: integer
        discountType:
          $ref: './shared.yaml#/components/schemas/DiscountType'
        specifiedCents:
          type: integer
          format: int64
        specifiedPercent:
          type: string
        amountBaseCents:
          readOnly: true
          type: integer
          format: int64
        amountTotalCents:
          readOnly: true
          type: integer
          format: int64
    LineItemRefundDTO:
      properties:
        id:
          type: integer
          format: int64
        amountToRefundUnitCents:
          type: integer
          format: int64
        amountToRefundTotalCents:
          readOnly: true
          type: integer
          format: int64
        amountRefundedCents:
          readOnly: true
          type: integer
          format: int64
        refundQuantity:
          type: integer
        restock:
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/PurchaseStockedItemDTO'
        returnStock:
          type: boolean
        revokeAfter:
          type: boolean
        revokeDuring:
          type: boolean
        includeTaxes:
          type: array
          items:
            $ref: '#/components/schemas/LineItemRefundTaxDTO'
    LineItemRefundTaxDTO:
      required: [taxId]
      properties:
        id:
          type: integer
          format: int64
        taxId:
          type: integer
          format: int64
    #Maybe we split this into different dtos for different types (Purchase, Stock, Refund), idk (its all the same table)
    PurchaseStockedItemDTO:
      properties:
        assignId:
          type: integer
          format: int64
        itemInstanceId:
          type: integer
          format: int64
        quantity:
          type: integer
        stockChangeType:
          readOnly: true
          $ref: './shared.yaml#/components/schemas/StockChangeType'
        purchasableState:
          readOnly: true
          allOf:
            - $ref: './shared.yaml#/components/schemas/PurchasableState'
    PurchaseDamageWaiverDTO:
      properties:
        waiverId:
          type: integer
        personId:
          type: integer
        startDate:
          type: string
          format: date
        purchasableState:
          readOnly: true
          allOf:
            - $ref: './shared.yaml#/components/schemas/PurchasableState'
        voidCloseId:
          readOnly: true
          type: integer
    PurchaseGuestPrivilegesDTO:
      properties:
        assignId:
          type: integer
          format: int64
        membershipId:
          type: integer
        startDate:
          type: string
          format: date
        purchasableState:
          readOnly: true
          allOf:
            - $ref: './shared.yaml#/components/schemas/PurchasableState'
        voidCloseId:
          readOnly: true
          type: integer
    PurchaseClassSignupDTO:
      required: [instanceId, personId]
      properties:
        signupId:
          nullable: false
          type: integer
        signupType:
          readOnly: true
          nullable: false
          type: string
          minLength: 1
          maxLength: 1
        instanceId:
          readOnly: true
          nullable: false
          type: integer
        price:
          readOnly: true
          type: integer
        classTypeEnum:
          nullable: false
          $ref: './shared.yaml#/components/schemas/ClassTypeEnum'
        personId:
          nullable: false
          type: integer
        purchasableState:
          readOnly: true
          allOf:
            - $ref: './shared.yaml#/components/schemas/PurchasableState'
        voidCloseId:
          readOnly: true
          type: integer
    MembershipDTO:
      x-has-dto: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/Membership'
    PurchaseMembershipDTO:
      x-has-dto: true
      allOf:
        - $ref: '#/components/schemas/MembershipDTO'
    PurchaseDonationDTO:
      required: [fundId,initiativeId, state]
      properties:
        donationId:
          nullable: false
          type: integer
        fundId:
          type: integer
        donationDate:
          type: string
          format: date-time
        description:
          type: string
          maxLength: 500
        restriction:
          type: string
          maxLength: 500
        initiativeId:
          type: integer
        inMemoryOf:
          nullable: true
          type: string
        isMatch:
          nullable: true
          type: boolean
        inKind:
          nullable: true
          type: boolean
        skipAck:
          nullable: true
          type: boolean
        personId:
          nullable: false
          type: integer
        amount:
          readOnly: true
          type: number
          format: double
        purchasableState:
          readOnly: true
          allOf:
            - $ref: './shared.yaml#/components/schemas/PurchasableState'
        voidCloseId:
          readOnly: true
          type: integer
    CardDTO:
      x-has-dto: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/Card'
    PurchaseCardDTO:
      x-has-dto: true
      type: object
      allOf:
        - $ref: '#/components/schemas/CardDTO'
    PurchaseGiftCardDTO:
      properties:
        assignId:
          type: integer
          format: int64
        personId:
          writeOnly: true
          type: integer
        cardNum:
          writeOnly: true
          type: string
        isRecharge:
          writeOnly: true
          type: boolean
        balance:
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/BalanceDTO'
        balanceTransactionType:
          readOnly: true
          $ref: './shared.yaml#/components/schemas/BalanceTransactionType'
        transactionAmountCents:
          type: integer
          format: int64
        purchasableState:
          readOnly: true
          allOf:
            - $ref: './shared.yaml#/components/schemas/PurchasableState'
    
    PersonSubscriptionDTO:
      required: [id, personId, subscriptionId, billingCycle]
      properties:
        assignId:
          type: integer
          format: int64
        personId:
          type: integer
        subscriptionId:
          type: integer
          format: int64
        billingDate:
          type: string
          format: date
        billingCycle:
          type: string
          maxLength: 50

    UserTest:
      type: object
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          example: user@example.com
        fullName:
          type: string
          example: John Doe
    TestRequest:
      type: object
      properties:
        derply:
          type: integer
          example: 1
        capacity:
          type: string
        dateTestReq:
          type: string
          format: date
        dateTimeTestReq:
          type: string
          format: date-time
    TestResponse:
      type: object
      properties:
        internalDiameter:
          type: integer
          example: 1
        dateTest:
          type: string
          format: date
        dateTimeTest:
          type: string
          format: date-time
    APEligibleClass:
      type: object
      properties:
        instanceId:
          type: integer
          example: 117
        typeName:
          type: string
          example: Intermediate 2
        sessionCount:
          type: integer
          example: 2
        sessionDates:
          type: array
          example: [01-APR-2010, 02-APR-2010]
          items:
            type: string
            format: date
        signupsAvailable:
          type: boolean
          example: T
        nextSignupsOpen:
          type: string
          format: date-time
        nextSignupsCount:
          type: integer
          example: 10
        instructor:
          type: string
          example: Joe L.
        location:
          type: string
          example: Dockhouse 
        booleanEnumTest:
          $ref: './shared.yaml#/components/schemas/Boolean'
          example: 'T'
    APFutureClass:
      type: object
      properties:
        enumTest:
          $ref: "./shared.yaml#/components/schemas/EnumTest"
          example: 'A'
        instanceId:
          type: integer
          example: 117
        typeName:
          type: string
          example: Intermediate 2
        sessionCount:
          type: integer
          example: 2
        sessionDates:
          type: array
          example: [01-APR-2010, 02-APR-2010]
          items:
            type: string
            format: date
        sessionLengthMinutes:
          type: integer
          example: 120
        signupsAvailable:
          type: boolean
          example: Y
        nextSignupsOpen:
          type: string
          format: date-time
        nextSignupsCount:
          type: integer
          example: 10
        instructor:
          type: string
          example: Joe L.
        location:
          type: string
          example: Dockhouse 
    APClassEnroll:
      type: object
      properties:
        personId:
          type: integer
          example: 192535
        instanceId:
          type: integer
          example: 117
    PersonPublicDTO:
      x-has-dto: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/PersonBase'
        - type: object
          properties:
            phones:
              type: array
              items:
                $ref: '#/components/schemas/PhoneDTO'
            addresses:
              type: array
              items:
                $ref: '#/components/schemas/AddressDTO'
    PersonDTO:
      x-has-dto: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/Person'
        - $ref: '#/components/schemas/PersonPublicDTO'
        - type: object
          properties:
            cards:
              type: array
              x-base-type: false
              items:
                $ref: '#/components/schemas/CardDTO'
            memberships:
              type: array
              x-base-type: MembershipDTO
              items:
                $ref: '#/components/schemas/MembershipDTO'
            relationsA:
              x-column-parent-fk: a
              x-base-type: false
              type: array
              items:
                $ref: '#/components/schemas/PersonRelationDTO'
            relationsB:
              x-column-parent-fk: b
              x-base-type: false
              type: array
              items:
                $ref: '#/components/schemas/PersonRelationDTO'
    PersonPublicChildDTO:
      x-has-dto: true
      allOf:
        - $ref: '#/components/schemas/PersonPublicDTO'
        - type: object
          properties:
            currentMemberships:
              readOnly: true
              type: array
              items:
                $ref: '#/components/schemas/MembershipDTO'
            currentCards:
              readOnly: true
              type: array
              items:
                $ref: '#/components/schemas/CardDTO'
            emergencyContacts:
              type: array
              items:
                $ref: '#/components/schemas/PersonPublicDTO'
            purchaseRecipients:
              type: array
              items:
                $ref: '#/components/schemas/PersonPublicDTO'
    PersonPublicParentDTO:
      x-has-dto: true
      allOf:
        - $ref: '#/components/schemas/PersonPublicChildDTO'
        - type: object
          properties:
            children:
              type: array
              items:
                $ref: '#/components/schemas/PersonPublicChildDTO'
        #relationsB:
        #  x-column-parent-fk: B
        #  type: array
        #  items:
        #    $ref: '#/components/schemas/PersonPublicRelatedDTO'
        #DE
    PersonRelationDTO:
      x-has-dto: true
      required: [ assignId ]
      allOf:
        - $ref: './shared.yaml#/components/schemas/PersonRelation'
        - $ref: '#/components/schemas/PersonDTO'
        - type: object
          properties:
            a:
              $ref: '#/components/schemas/PersonDTO'
            b:
              $ref: '#/components/schemas/PersonDTO'
    PhoneDTO:
      x-has-dto: true
      x-has-dao: false
      allOf:
        - $ref: './shared.yaml#/components/schemas/Phone'
        - $ref: './shared.yaml#/components/schemas/PersonPhoneBase'
    PersonReferralDTO:
      x-has-dto: true
      required: [assignId]
      allOf:
        - $ref: './shared.yaml#/components/schemas/PersonReferral'
        - type: object
    PersonLanguageDTO:
      x-has-dto: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/PersonLanguage'
    TestChange:
      type: object
    AddressDTO:
      x-has-dto: true
      allOf:
        - $ref: './shared.yaml#/components/schemas/Address'
        - $ref: './shared.yaml#/components/schemas/PersonAddressBase'
    ValidationTestDTO:
      type: object
      properties:
        testA:
          type: string
          maxLength: 100
          minLength: 10
        testB:
          type: integer
          minimum: 1
          maximum: 25
        testC:
          type: string
          pattern: ^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$
